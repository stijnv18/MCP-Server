# AGENT INSTRUCTIONS FOR DATABASE SEARCH

You have access to two main databases on kgaprd-sql.gkaneka.local: **BC_VLTS_DATA** (assets and projects) and **AIM_KANEKA** (documents).

## Database Server
- **Server**: kgaprd-sql.gkaneka.local
- **Databases**: BC_VLTS_DATA, AIM_KANEKA

## BC_VLTS_DATA - Assets & Projects

### Asset Management
- **Primary View**: `BCAssetPropertiesViewByNameBCE` - Contains all asset properties
- **Asset Identification**:
  - Uniqueness determined by `[SAP EQUIPMENT NUMBER]` + `[PROJECT NUMBER]`
  - Tag format: `[TAG TYPE]` + " " + `[SEQUENCE NUMBER]` + " " + `[DEPARTMENT]`
  - Example: "V 2210 H EPE" = "V" + " " + "2210 H" + " " + "EPE"
- **Departments**: Always 3 characters (MOD, EPE, MSE, SUP)
- **Asset Status**: Assets with `status='retired'` are decommissioned and should be excluded unless explicitly requested
- **Asset Category, Asset Class and Asset Subclass**: Together categorize the asset
- **Process Information**: Retrieve from Functional Location, Unit, Process, sub process and their descriptions
- **Asset in Workflow**: `[c_psApproval_WFStateApproval]` is not null

### Project Management
- **Primary View**: `ProjectPropertiesView` - Contains all project information
- **Project Types**: Projects starting with "RFE-" are investments
- **Project Lookup**: Use `LIKE '%[project_number]%'` for partial matching
- **Asset-Project Relationship**: Join on `PROJECT NUMBER` field
- **Open Projects**: Projects with state different from "Closed" or "discontinued"
- **Plant/As-built Environment**: `[PROJECT NUMBER]='-'`

## AIM_KANEKA - Documents

### Document Management
- **Primary View**: `DocumentPropertiesViewCoPilot` - Contains all document information
- **Asset-Document References**: `AssetDocRefViewCoPilot` - Links assets to documents
- **Key Field**: `[c_psDocument_DocumentTitle]` - Most commonly queried field
- **Document Categories**: Use `[c_psDocument_DocumentCategoryD]`, `[c_psDocument_DocumentSubC_0]`
- **Document Types**: PID, INV, COM, LAY (refer to `[c_psDocument_DocumentCategory]`)
- **Vendor Information**: Check `[c_psdocument_vendor]` and `[c_psDocumentReferenceDrawingN]`
- **Retired Documents**: Documents with `[c_psDocument_documentAsBuiltSt]='Retired'` are decommissioned
- **Plant/As-built Environment**: `[c_psProject_ProjectNumber]='-'`

### Asset-Document Relationships
- Retrieve assets via `AssetDocRefViewCoPilot.[ObjectTagRevisionID]` → `BCAssetPropertiesViewByNameBCE.[ObjectTagRevisionID]`
- Retrieve documents via `AssetDocRefViewCoPilot.DocumentRevisionID` → `DocumentPropertiesViewCoPilot.DocumentRevisionID`
- Order references by `BCAssetPropertiesViewByNameBCE.[Tag Number]` or `DocumentPropertiesViewCoPilot.[FileName]`

## Query Patterns

### Asset Search Examples
```sql
-- Find asset by tag components
SELECT * FROM [BC_VLTS_DATA].[dbo].[BCAssetPropertiesViewByNameBCE]
WHERE [TAG TYPE] = 'V'
  AND [SEQUENCE NUMBER] = '2210 H'
  AND [DEPARTMENT] = 'EPE'
  AND [STATUS] != 'retired'

-- Find assets by project
SELECT * FROM [BC_VLTS_DATA].[dbo].[BCAssetPropertiesViewByNameBCE]
WHERE [PROJECT NUMBER] LIKE '%1357%'
  AND [STATUS] != 'retired'
```

### Project Search Examples
```sql
-- Find investment projects
SELECT * FROM [BC_VLTS_DATA].[dbo].[ProjectPropertiesView]
WHERE [ProjectNumber] LIKE 'RFE-%'

-- Find project by partial number
SELECT * FROM [BC_VLTS_DATA].[dbo].[ProjectPropertiesView]
WHERE [ProjectNumber] LIKE '%1357%'
```

### Document Search Examples
```sql
-- Search documents by title
SELECT [c_psDocument_DocumentTitle], [ProjectNumber], [FileName], *
FROM [AIM_KANEKA].[dbo].[DocumentPropertiesViewCoPilot]
WHERE [c_psDocument_DocumentTitle] LIKE '%search_term%'
  AND [c_psDocument_documentAsBuiltSt] != 'Retired'

-- Find documents by category
SELECT * FROM [AIM_KANEKA].[dbo].[DocumentPropertiesViewCoPilot]
WHERE [c_psDocument_DocumentCategory] = 'PID'
  AND [c_psDocument_documentAsBuiltSt] != 'Retired'

-- Find documents with vendor information
SELECT * FROM [AIM_KANEKA].[dbo].[DocumentPropertiesViewCoPilot]
WHERE [c_psdocument_vendor] IS NOT NULL
   OR [c_psDocumentReferenceDrawingN] IS NOT NULL
```

### Asset-Document Relationship Examples
```sql
-- Find documents for an asset
SELECT d.[c_psDocument_DocumentTitle], d.[FileName], d.[ProjectNumber]
FROM [AIM_KANEKA].[dbo].[AssetDocRefViewCoPilot] r
JOIN [AIM_KANEKA].[dbo].[DocumentPropertiesViewCoPilot] d ON r.DocumentRevisionID = d.DocumentRevisionID
JOIN [BC_VLTS_DATA].[dbo].[BCAssetPropertiesViewByNameBCE] a ON r.[ObjectTagRevisionID] = a.[ObjectTagRevisionID]
WHERE a.[TAG NUMBER] = 'V 2210 H EPE'
ORDER BY d.[FileName]

-- Find assets for a document
SELECT a.[TAG NUMBER], a.[SAP EQUIPMENT NUMBER], a.[PROJECT NUMBER]
FROM [AIM_KANEKA].[dbo].[AssetDocRefViewCoPilot] r
JOIN [AIM_KANEKA].[dbo].[DocumentPropertiesViewCoPilot] d ON r.DocumentRevisionID = d.DocumentRevisionID
JOIN [BC_VLTS_DATA].[dbo].[BCAssetPropertiesViewByNameBCE] a ON r.[ObjectTagRevisionID] = a.[ObjectTagRevisionID]
WHERE d.[c_psDocument_DocumentTitle] LIKE '%PID%'
ORDER BY a.[TAG NUMBER]
```

## MCP Tool Usage Examples

### Asset Search
```json
{
  "tag_type": "V",
  "sequence_number": "2210 H",
  "department": "EPE"
}
```

### Project Search
```json
{
  "project_number": "1357",
  "project_type": "RFE"
}
```

### Document Search
```json
{
  "title": "completion report",
  "category": "COM",
  "include_retired": false
}
```

### Asset-Document Relationships
```json
{
  "asset_tag": "V 2210 H EPE"
}
```

## Best Practices

- Always return the file name when available
- Use partial matching for project numbers and document titles
- Include department codes when searching assets
- Filter by project type (RFE for investments) when appropriate
- Exclude retired assets and documents unless specifically requested
- Use relationship tools to find connected data across databases
- If the question is unclear, ask user to specify further
- Read all available columns to understand what data is accessible
- Start with `get_distinct_values` to explore column content
- Use `get_columns` to understand table structure before complex queries